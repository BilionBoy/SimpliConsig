<div class="modern-dashboard">
  <!-- Header -->
  <div class="page-header clients-header shadow-sm">
    <div class="page-header-content d-lg-flex">
      <div class="d-flex">
        <div class="breadcrumb modern-breadcrumb py-3">
          <a href="/" class="breadcrumb-item">
            <i data-lucide="home" style="width: 16px; height: 16px;"></i>
          </a>
          <span class="breadcrumb-item active"><%%= t("activerecord.models.#{<%= class_name %>.model_name.i18n_key}.other") %></span>
        </div>
      </div>
    </div>
  </div>

  <div class="content" style="padding: 32px 24px;">
    <!-- Estatísticas Rápidas -->
    <div class="clients-stats">
      <div class="stat-mini">
        <div class="stat-mini-value"><%%= @<%= plural_table_name %>.count %></div>
        <div class="stat-mini-label">Total</div>
      </div>
      <%% if @<%= plural_table_name %>.respond_to?(:where) %>
        <%% if @<%= plural_table_name %>.column_names.include?('ativo') %>
          <div class="stat-mini">
            <div class="stat-mini-value"><%%= @<%= plural_table_name %>.where(ativo: true).count %></div>
            <div class="stat-mini-label">Ativos</div>
          </div>
          <div class="stat-mini">
            <div class="stat-mini-value"><%%= @<%= plural_table_name %>.where(ativo: false).count %></div>
            <div class="stat-mini-label">Inativos</div>
          </div>
        <%% end %>
        <div class="stat-mini">
          <div class="stat-mini-value"><%%= @<%= plural_table_name %>.where('created_at >= ?', 30.days.ago).count %></div>
          <div class="stat-mini-label">Novos (30d)</div>
        </div>
      <%% end %>
    </div>

    <!-- Filtros de Busca -->
    <div class="search-filters">
      <%%= search_form_for @q, html: { class: "filter-group", autocomplete: "off" } do |f| %>
        <div class="form-group">
          <label class="form-label">Buscar <%%= t("activerecord.models.#{<%= class_name %>.model_name.i18n_key}.one") %></label>
          <%%= f.search_field :<%= attributes.first.name %>_cont, class: "form-input", placeholder: "Digite para buscar..." %>
        </div>
        
        <%% if @<%= plural_table_name %>.column_names.include?('ativo') %>
          <div class="form-group">
            <label class="form-label">Status</label>
            <%%= f.select :ativo_eq, options_for_select([['Todos os status', ''], ['Ativo', true], ['Inativo', false]], params.dig(:q, :ativo_eq)), {}, { class: "form-select" } %>
          </div>
        <%% end %>

        <div class="form-group">
          <button type="submit" class="modern-btn modern-btn-primary" style="height: 44px;">
            <i data-lucide="search" style="width: 16px; height: 16px;"></i>
            Buscar
          </button>
        </div>
        
        <%% if params[:q] %>
          <div class="form-group">
            <%%= link_to <%= plural_table_name %>_path, class: "modern-btn modern-btn-outline", style: "height: 44px;" do %>
              <i data-lucide="x" style="width: 16px; height: 16px;"></i>
              Limpar
            <%% end %>
          </div>
        <%% end %>
      <%% end %>
    </div>

    <!-- Tabela -->
    <div class="modern-card">
      <div class="modern-card-header d-flex align-items-center justify-content-between">
        <h5 class="modern-card-title">
          <i data-lucide="database" style="width: 20px; height: 20px;"></i>
          Lista de <%%= t("activerecord.models.#{<%= class_name %>.model_name.i18n_key}.other") %>
        </h5>
        <div class="card-actions">
          <button class="btn-export">
            <i data-lucide="download" style="width: 16px; height: 16px;"></i>
            Exportar
          </button>
          <%%= link_to new_<%= singular_table_name %>_path, class: "btn-new-client" do %>
            <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
            Novo <%%= t("activerecord.models.#{<%= class_name %>.model_name.i18n_key}.one") %>
          <%% end %>
        </div>
      </div>

      <div class="table-responsive">
        <table class="modern-table">
          <thead>
            <tr>
              <th style="width: 50px;">
                <input type="checkbox" id="selectAll" style="width: 16px; height: 16px;">
              </th>
              <th style="text-align: center;">Ações</th>
              <% attributes_to_ignore = ['deleted_at', 'original_user_create', 'last_user_update', 'created_by', 'updated_by', 'id'] %>
              <%- attributes.each do |attribute| -%>
                <% unless attributes_to_ignore.include?(attribute.name) %>
                  <th><%%= sort_link(@q, :<%= attribute.name %>, t("activerecord.attributes.<%= singular_table_name %>.<%= attribute.name %>")) %></th>
                <% end %>
              <%- end -%>
              <th>Cadastro</th>
            </tr>
          </thead>
          <tbody>
            <%% @<%= plural_table_name %>.each do |<%= singular_table_name %>| %>
              <tr>
                <td>
                  <input type="checkbox" class="record-checkbox" style="width: 16px; height: 16px;">
                </td>
                <td style="text-align: center;">
                  <div class="dropdown">
                    <button type="button" class="action-btn dropdown-toggle" data-bs-toggle="dropdown">
                      <i data-lucide="more-horizontal" style="width: 16px; height: 16px;"></i>
                    </button>
                    <div class="dropdown-menu">
                      <%%= link_to <%= singular_table_name %>_path(<%= singular_table_name %>), class: "dropdown-item" do %>
                        <i data-lucide="eye" style="width: 16px; height: 16px;"></i>
                        Visualizar
                      <%% end %>
                      <%%= link_to edit_<%= singular_table_name %>_path(<%= singular_table_name %>), class: "dropdown-item" do %>
                        <i data-lucide="edit" style="width: 16px; height: 16px;"></i>
                        Editar
                      <%% end %>
                      <div class="dropdown-divider"></div>
                      <%%= link_to <%= singular_table_name %>_path(<%= singular_table_name %>), method: :delete, 
                          confirm: 'Tem certeza?', class: "dropdown-item text-danger" do %>
                        <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                        Excluir
                      <%% end %>
                    </div>
                  </div>
                </td>
                <%- attributes.each do |attribute| -%>
                  <% unless attributes_to_ignore.include?(attribute.name) %>
                    <td>
                      <% if attribute.type == :boolean %>
                        <%% if <%= singular_table_name %>.<%= attribute.name %> %>
                          <span class="client-status active">Sim</span>
                        <%% else %>
                          <span class="client-status inactive">Não</span>
                        <%% end %>
                      <% elsif attribute.type == :date || attribute.type == :datetime %>
                        <span style="color: var(--neutral-600);">
                          <%%= <%= singular_table_name %>.<%= attribute.name %>&.strftime('%d/%m/%Y') %>
                        </span>
                      <% elsif attribute.type == :decimal || attribute.type == :float %>
                        <span style="color: var(--neutral-600);">
                          <%%= number_to_currency(<%= singular_table_name %>.<%= attribute.name %>) if <%= singular_table_name %>.<%= attribute.name %> %>
                        </span>
                      <% else %>
                        <span style="color: var(--neutral-600);">
                          <%%= truncate(<%= singular_table_name %>.<%= attribute.name %>, length: 30) %>
                        </span>
                      <% end %>
                    </td>
                  <% end %>
                <%- end -%>
                <td style="color: var(--neutral-600);">
                  <%%= <%= singular_table_name %>.created_at.strftime('%d/%m/%Y') %>
                </td>
              </tr>
            <%% end %>
          </tbody>
        </table>
      </div>

      <%% if respond_to?(:pagy_bootstrap_nav) %>
        <div class="modern-card-footer">
          <%%= pagy_bootstrap_nav(@pagy).html_safe %>
        </div>
      <%% end %>
    </div>
  </div>
</div>

<script>
// Seleção em lote
document.getElementById('selectAll').addEventListener('change', function() {
  const checkboxes = document.querySelectorAll('.record-checkbox');
  checkboxes.forEach(checkbox => {
    checkbox.checked = this.checked;
  });
});

// Checkboxes individuais
document.querySelectorAll('.record-checkbox').forEach(checkbox => {
  checkbox.addEventListener('change', function() {
    const checkedBoxes = document.querySelectorAll('.record-checkbox:checked');
    const selectAll = document.getElementById('selectAll');
    selectAll.checked = checkedBoxes.length === document.querySelectorAll('.record-checkbox').length;
  });
});
</script>